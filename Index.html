<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <title>SmartBuild – Building Calculator</title>
  <style>
    /* ===== Base Page Styling ===== */
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: 
        linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
        url('keje.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Poppins', sans-serif;
      color: white;
    }

    h2 { margin-top: 10px; }

    .toolbar { margin-bottom: 20px; }

    .btn {
      padding: 8px 14px;
      margin-right: 8px;
      margin-top: 20px;
      border-radius: 6px;
      border: 1px solid #333;
      cursor: pointer;
    }

    .btn.ghost { background: #fff; color: #333; }
    .btn.primary { background: #2e7d32; color: #fff; border-color: #2e7d32; }
    .hidden { display: none; }

    /* ===== Main Container ===== */
    .container {
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 25px;
      max-width: 900px;
      margin: 50px auto;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.4);
    }

    /* ===== Section Panels ===== */
    .section {
      background: rgba(0, 0, 0, 0.45);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
    }

    .section:hover {
      background: rgba(0, 0, 0, 0.65);
      transform: translateY(-3px);
    }

    /* ===== Two-Column Layout ===== */
    .section-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      align-items: start;
      margin-bottom: 30px;
    }

    /* ===== Fact Box Styling ===== */
    .fact-box {
      display: none;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(6px);
      padding: 15px 20px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      visibility: hidden;
  opacity: 0;
  transition: opacity 0.3s ease;
    }

    .fact-box h3 {
      color: #a7ff83;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    .fact-box p {
      color: #e0e0e0;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .fact-box.active {
      display: block;
      visibility: visible;
  opacity: 1;
    }

    /* ===== Input Fields ===== */
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    input::placeholder {
      color: #ccc;
    }

    /* ===== Buttons ===== */
    button {
      background: rgba(255, 255, 255, 0.08);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 10px 18px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }

    button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    /* ===== Headings ===== */
    h2, h3, h4 {
      text-align: center;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }

    /* ===== Report Section ===== */
    #report {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* ===== SmartBuild Title ===== */
    h1#smartbuildTitle {
      font-size: 3rem;
      text-align: center;
      font-weight: 700;
      letter-spacing: 2px;
      margin-bottom: 25px;
      color: #fff;
      text-shadow: 
        0 0 10px rgba(255, 255, 255, 0.6),
        0 0 20px rgba(255, 255, 255, 0.4),
        0 0 30px rgba(255, 255, 255, 0.2);
      animation: fadeInTitle 1.2s ease forwards;
    }

    @keyframes fadeInTitle {
      from { opacity: 0; transform: translateY(-15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #smartbuildTagline {
      text-align: center;
      font-size: 1.1rem;
      color: #ddd;
      letter-spacing: 1px;
      margin-top: -10px;
      opacity: 0;
      animation: fadeInTagline 1.5s ease forwards;
      animation-delay: 1.3s;
    }

    @keyframes fadeInTagline {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== Output Box ===== */
    .out {
      border: 2px solid #2e7d32;
      background-color: #f1f8e9;
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
      font-family: "Poppins", sans-serif;
      color: #000;
      font-weight: 500;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .out:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    #projectManager {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 15px;
      color: white;
      padding: 20px;
      margin-bottom: 20px;
      text-align: left;
    }

    .projectControls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    #projectList button {
      margin-left: 10px;
      background-color: #2e7d32;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 5px 10px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    #projectList button:hover {
      background-color: #388e3c;
    }
    #concreteState {
  color: black;      /* sets text color of selected item */
  background-color: white; /* optional: makes dropdown background white */
}

#concreteState option {
  color: black; /* sets text color of options in dropdown */
}
    
  </style>
</head>

<body>
  <!-- Title and Tagline -->
  <h1 id="smartbuildTitle">SmartBuild</h1>
  <p id="smartbuildTagline">Your trusted partner for building and construction excellence</p>

  <!-- Project Name Input -->
  <div class="projectControls">
    <input type="text" id="newProjectName" placeholder="Enter new project name">
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <button class="btn primary" id="btnConcrete">Concrete</button>
    <button class="btn ghost" id="btnRebar">Rebar</button>
    <button class="btn ghost" id="btnFormworkColumn">Formwork Column</button>
    <button class="btn ghost" id="btnFormworkUGB">Formwork Upper Ground Beam</button>
    <button class="btn ghost" id="btnFormworkGB">Formwork Ground Beam</button>
    <button class="btn ghost" id="btnFormworkFoundation">Formwork Foundation</button>
    <button class="btn ghost" id="btnFormwork">Formwork</button>
    <button class="btn ghost" id="btnCeiling">Ceiling Finishes</button>
    <button class="btn ghost" id="btnFloor">Floor Finishes</button>
    <button class="btn ghost" id="btnWallExt">Wall Finishes External</button>
    <button class="btn ghost" id="btnWallInt">Wall Finishes Internal</button>
  </div>

  <!-- ===== Concrete Section ===== -->
  <div class="section-container">
    <div class="section" id="sectionConcrete">
      <h2>Concrete Calculation</h2>

      <label>State:
        <select id="concreteState">
          <option value="" disabled selected>Choose state</option>
          <option data-price="310">Johor (RM310/m³)</option>
          <option data-price="295">Kedah (RM295/m³)</option>
          <option data-price="300">Kelantan (RM300/m³)</option>
          <option data-price="320">Melaka (RM320/m³)</option>
          <option data-price="315">Negeri Sembilan (RM315/m³)</option>
          <option data-price="325">Pahang (RM325/m³)</option>
          <option data-price="290">Perlis (RM290/m³)</option>
          <option data-price="305">Penang (RM305/m³)</option>
          <option data-price="335">Perak (RM335/m³)</option>
          <option data-price="345">Sabah (RM345/m³)</option>
          <option data-price="340">Sarawak (RM340/m³)</option>
          <option data-price="315">Selangor (RM315/m³)</option>
          <option data-price="310">Terengganu (RM310/m³)</option>
          <option data-price="330">Kuala Lumpur (RM330/m³)</option>
        </select>
      </label>

      <label>Length (m) <input id="concreteLength" type="number"></label>
      <label>Width (m) <input id="concreteWidth" type="number"></label>
      <label>Height (m) <input id="concreteHeight" type="number" step="0.01"></label>
      <label>Wastage (%) <input id="concreteWaste" type="number" value="0"></label>

      <button class="btn primary" id="calcConcrete">Count Concrete</button>
      <div class="out" id="concreteOut">Result is shown here</div>
    </div>

    <div class="fact-box" id="factConcrete">
      <h3>Did You Know?</h3>
      <p>Concrete is the most used construction material on Earth. It gains about 70% of its strength within 7 days and continues to harden for decades!</p>
      <p>Average density: <strong>2400 kg/m³</strong>. Proper curing prevents cracks and increases durability.</p>
    </div>
  </div>

<!-- ===== Rebar ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionRebar">
    <h2>Rebar Calculation</h2>
    <label>Length (m) <input id="rebarLength" type="number"></label>
    <label>Lap <input id="rebarLap" type="number"></label>
    <label>Bend <input id="rebarBend" type="number" value="0"></label>
    <label>Hook <input id="rebarHook" type="number"></label>
    <label>Steel Weight (kg) <input id="rebarWeight" type="number"></label>
    <label>Steel Price (RM/kg) <input id="rebarPrice" type="number" step="0.01"></label>
    <button class="btn primary" id="calcRebar">Count Rebar</button>
    <div class="out" id="rebarOut">Result is shown here</div>
    <div id="rebarMsg"></div>
  </div>

  <div class="fact-box" id="factRebar">
    <h3>Steel Reinforcement Facts</h3>
    <p>Rebars provide the tensile strength that concrete lacks. Typical rebar yield strength is <strong>500 MPa</strong>.</p>
    <p>Adding ribbed steel bars improves bonding with concrete and prevents slippage.</p>
  </div>
</div>

<!-- ===== Formwork Column ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionFormworkColumn">
    <h2>Formwork Column Calculation</h2>
    <label>Girth <input id="formColGirth" type="number"></label>
    <label>Formwork (Timber) Price (RM) <input id="formColPrice" type="number"></label>
    <button class="btn primary" id="calcFormCol">Count Formwork Column</button>
    <div class="out" id="formColOut">Result is shown here</div>
    <div id="formColMsg"></div>
  </div>

  <div class="fact-box" id="factFormworkColumn">
    <h3>Formwork Insight</h3>
    <p>Formwork temporarily supports fresh concrete until it gains enough strength to hold its own shape.</p>
    <p>Timber formwork is common due to low cost, but metal and plastic forms provide better reusability.</p>
  </div>
</div>

<!-- ===== Formwork Upper Ground Beam ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionFormworkUGB">
    <h2>Formwork Upper Ground Beam Calculation</h2>
    <label>Side Length (L+R) <input id="formUGBSide" type="number"></label>
    <label>Soffit Length <input id="formUGBSoffit" type="number"></label>
    <label>Timber Price <input id="formUGBPrice" type="number"></label>
    <button class="btn primary" id="calcFormUGB">Count Formwork Upper Ground Beam</button>
    <div class="out" id="formUGBOut">Result is shown here</div>
    <div id="formUGBMsg"></div>
  </div>

  <div class="fact-box" id="factFormworkUGB">
    <h3>Beam Construction Tip</h3>
    <p>Formwork for beams must be rigid and properly supported to prevent deflection.</p>
    <p>Ensure correct curing time to avoid cracks where beams meet columns.</p>
  </div>
</div>

<!-- ===== Formwork Ground Beam ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionFormworkGB">
    <h2>Formwork Ground Beam Calculation</h2>
    <label>Side Length (L+R) <input id="formGBSide" type="number"></label>
    <label>Timber Price <input id="formGBPrice" type="number"></label>
    <button class="btn primary" id="calcFormGB">Count Formwork Ground Beam</button>
    <div class="out" id="formGBOut">Result is shown here</div>
    <div id="formGBMsg"></div>
  </div>

  <div class="fact-box" id="factFormworkGB">
    <h3>Ground Beam Facts</h3>
    <p>Ground beams distribute loads evenly between columns and foundations.</p>
    <p>Proper reinforcement ensures resistance against soil settlement and lateral forces.</p>
  </div>
</div>

<!-- ===== Formwork Foundation ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionFormworkFoundation">
    <h2>Formwork Foundation Calculation</h2>
    <label>Girth <input id="formFoundGirth" type="number"></label>
    <label>Timber Price <input id="formFoundPrice" type="number"></label>
    <button class="btn primary" id="calcFormFound">Count Formwork Foundation</button>
    <div class="out" id="formFoundOut">Result is shown here</div>
    <div id="formFoundMsg"></div>
  </div>

  <div class="fact-box" id="factFormworkFoundation">
    <h3>Foundation Facts</h3>
    <p>Formwork foundation supports concrete until it cures.</p>
    <p>Accurate girth measurement and timber pricing are essential for cost estimation.</p>
  </div>
</div>

<!-- ===== General Formwork ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionFormwork">
    <h2>General Formwork Calculation</h2>
    <label>Length <input id="formLength" type="number"></label>
    <label>Width <input id="formWidth" type="number"></label>
    <label>Price <input id="formPrice" type="number"></label>
    <button class="btn primary" id="calcForm">Count Formwork</button>
    <div class="out" id="formOut">Result is shown here</div>
    <div id="formMsg"></div>
  </div>

  <div class="fact-box" id="factFormwork">
    <h3>General Formwork Facts</h3>
    <p>Formwork molds concrete until it sets.</p>
    <p>Check all measurements and pricing carefully before calculating.</p>
  </div>
</div>

<!-- ===== Ceiling Finishes ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionCeiling">
    <h2>Ceiling Finishes Calculation</h2>
    <label>Length (m) <input id="ceilLength" type="number" step="0.01"></label>
    <label>Width (m) <input id="ceilWidth" type="number" step="0.01"></label>
    <label>Type 
      <select id="ceilType">
        <option value="plastering" data-price="25">Plastering (RM25/m²)</option>
        <option value="gypsum" data-price="35">Gypsum Board (RM35/m²)</option>
        <option value="acoustic" data-price="45">Acoustic Ceiling (RM45/m²)</option>
      </select>
    </label>
    <button class="btn primary" id="calcCeil">Calculate Ceiling Finishes</button>
    <div class="out" id="ceilOut">Result is shown here</div>
    <div id="ceilMsg"></div>
  </div>

  <div class="fact-box" id="factCeiling">
    <h3>Ceiling Facts</h3>
    <p>Gypsum board ceilings are fire-resistant and provide good sound insulation.</p>
    <p>Acoustic ceilings help absorb noise in commercial or office spaces.</p>
  </div>
</div>

<!-- ===== Floor Finishes ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionFloor">
    <h2>Floor Finishes Calculation</h2>
    <label>Length (m) <input id="floorLength" type="number"></label>
    <label>Width (m) <input id="floorWidth" type="number"></label>
    <label>Skirting <input id="floorSkirting" type="number"></label>
    <label>Drop <input id="floorDrop" type="number"></label>
    <label>Finish Type 
      <select id="floorType">
        <option value="tiling" data-price="25">Tiling (RM25/m²)</option>
        <option value="slab" data-price="35">Slab (RM35/m²)</option>
      </select>
    </label>
    <button class="btn primary" id="calcFloor">Calculate Floor Finishes</button>
    <div class="out" id="floorOut">Result is shown here</div>
    <div id="floorMsg"></div>
  </div>

  <div class="fact-box" id="factFloor">
    <h3>Floor Finishing Facts</h3>
    <p>Ceramic tiles are durable and waterproof — perfect for bathrooms and kitchens.</p>
    <p>Concrete slabs are cost-effective and commonly used for industrial flooring.</p>
  </div>
</div>

<!-- ===== Wall Finishes (External) ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionWallExt">
    <h2>Wall Finishes (External) Calculation</h2>
    <label>Length (m) <input id="wallExtLength" type="number"></label>
    <label>Width (m) <input id="wallExtWidth" type="number"></label>
    <label>Damp Proof Membrane (m) <input id="wallExtDPM" type="number"></label>
    <label>Coating <input id="wallExtCoating" type="number"></label>
    <label>Finish Type 
      <select id="wallExtType">
        <option value="tiling" data-price="25">Tiling (RM25/m²)</option>
        <option value="plastering" data-price="35">Plastering (RM35/m²)</option>
        <option value="painting" data-price="15">Painting (RM15/m²)</option>
      </select>
    </label>
    <label>Price <input id="wallExtPrice" type="number"></label>
    <button class="btn primary" id="calcWallExt">Calculate Wall Finishes (External)</button>
    <div class="out" id="wallExtOut">Result will be shown here</div>
    <div id="wallExtMsg"></div>
  </div>

  <div class="fact-box" id="factWallExt">
    <h3>External Wall Facts</h3>
    <p>Exterior finishes protect buildings from moisture, heat, and pollution.</p>
    <p>Painting with UV-resistant coatings can extend wall life by over 5 years.</p>
  </div>
</div>

<!-- ===== Wall Finishes (Internal) ===== -->
<div class="section-container">
  <div class="section hidden" id="sectionWallInt">
    <h2>Wall Finishes (Internal) Calculation</h2>
    <label>Length (m) <input id="wallIntLength" type="number"></label>
    <label>Width (m) <input id="wallIntWidth" type="number"></label>
    <label>Coating <input id="wallIntCoating" type="number"></label>
    <label>Damp Proof Membrane (m) <input id="wallIntDPM" type="number"></label>
    <label>Finish Type 
      <select id="wallIntType">
        <option value="tiling" data-price="25">Tiling (RM25/m²)</option>
        <option value="plastering" data-price="35">Plastering (RM35/m²)</option>
        <option value="painting" data-price="15">Painting (RM15/m²)</option>
      </select>
    </label>
    <label>Price <input id="wallIntPrice" type="number"></label>
    <button class="btn primary" id="calcWallInt">Calculate Wall Finishes (Internal)</button>
    <div class="out" id="wallIntOut">Result will be shown here</div>
    <div id="wallIntMsg"></div>
  </div>

  <div class="fact-box" id="factWallInt">
    <h3>Internal Wall Facts</h3>
    <p>Interior plastering provides a smooth base for painting and prevents dust accumulation.</p>
    <p>Using moisture-resistant paint can extend the lifespan of walls in humid rooms.</p>
  </div>
</div>

 <!-- Project Manager -->
  <div id="projectManager" class="out">
    <h3>Project List</h3>
    <div id="projectList"></div>
  </div>

  <!-- Report Section -->
  <div id="report">—</div>


  <!-- ===== JAVASCRIPT ===== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
  // Activate Concrete fact box on load
  const factConcrete = document.getElementById('factConcrete');
  if (factConcrete) factConcrete.classList.add('active');

  // Existing setup
  const $ = id => document.getElementById(id);
  const read = id => parseFloat($(id)?.value) || 0;
  const fmt = n => "RM " + n.toFixed(2);

  const STATE = { results: {}, activeProject: null };
  let projects = JSON.parse(localStorage.getItem("smartbuildProjects")) || {};

  function saveProjects() {
    localStorage.setItem("smartbuildProjects", JSON.stringify(projects));
  }

  function renderProjects() {
    const list = $("projectList");
    if (!list) return;
    list.innerHTML = "";

    const names = Object.keys(projects).reverse();
    names.forEach(name => {
      const { updated, created } = projects[name];
      const item = document.createElement("div");
      item.className = "project-item";
      item.innerHTML = `
        <div class="project-row">
          <div class="project-info">
            <strong>${name}</strong><br>
            <small>Last Updated: ${updated || created || "N/A"}</small>
          </div>
          <div class="project-actions">
            <button onclick="loadProject('${name}')">Load</button>
            <button onclick="editProject('${name}')">Edit</button>
            <button onclick="deleteProject('${name}')">Delete</button>
          </div>
        </div>`;
      list.appendChild(item);
    });
  }

      function showSection(sectionId) {
  // Hide all sections but keep container height consistent
  document.querySelectorAll(".section").forEach(sec => sec.classList.add("hidden"));

  const section = $(sectionId);
  if (section) section.classList.remove("hidden");

  // Hide all fact boxes
  document.querySelectorAll(".fact-box").forEach(fact => fact.classList.remove("active"));

  // Match fact box to section
  const factId = sectionId.replace("section", "fact");
  const factBox = $(factId);
  if (factBox) factBox.classList.add("active");
}
      function updateReport() {
        const report = $("report");
        const total = Object.values(STATE.results).reduce((sum, item) => sum + (item.cost || 0), 0);
        if (total <= 0) {
          report.innerHTML = `<p>No calculations yet. Please perform a calculation.</p>`;
          return;
        }

        const inputField = $("newProjectName");
        const name = inputField.value.trim();
        if (!name) return alert("Please enter a project name before calculating.");

        STATE.activeProject = name;
        if (!projects[name]) {
          projects[name] = { results: {}, created: new Date().toLocaleString() };
        }

        const profit = total * 0.3;
        const grandTotal = total + profit;

        projects[name].results = { total, profit, grandTotal };
        projects[name].updated = new Date().toLocaleString();

        saveProjects();
        renderProjects();

        report.innerHTML = `
          <div class="report-summary">
            <h3>Project: ${name}</h3>
            <p><strong>Total:</strong> ${fmt(total)}</p>
            <p><strong>Profit (30%):</strong> ${fmt(profit)}</p>
            <p><strong>Grand Total:</strong> ${fmt(grandTotal)}</p>
          </div>`;
      }

  const calcs = {
  // === Concrete ===
  calcConcrete: () => {
    const stateSelect = $("concreteState");
    const rate = Number(stateSelect.selectedOptions[0].dataset.price);
    if (!rate) return alert("Please select a state to set the concrete rate.");

    const length = read("concreteLength");
    const width = read("concreteWidth");
    const height = read("concreteHeight");
    const wastage = read("concreteWaste");

    const vol = length * width * height * (1 + wastage / 100);
    const cost = vol * rate;

    STATE.results["Concrete"] = {
      detail: `Volume: ${vol.toFixed(2)} m³`,
      cost
    };

    $("concreteOut").innerHTML = `
      <strong>Concrete Calculation:</strong><br>
      Formula: (${length} × ${width} × ${height}) × (1 + ${wastage / 100})<br>
      Volume: ${vol.toFixed(2)} m³<br>
      Rate: ${fmt(rate)} per m³<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;

    updateReport();
  },

  // === Rebar ===
  calcRebar: () => {
    const len = read("rebarLength") + read("rebarLap") + read("rebarBend") + read("rebarHook");
    const weight = read("rebarWeight");
    const rate = read("rebarPrice");
    const cost = weight * rate;

    STATE.results["Rebar"] = { detail: `Length: ${len.toFixed(2)} m`, cost };

    $("rebarOut").innerHTML = `
      <strong>Rebar Calculation:</strong><br>
      Formula: ${read("rebarLength")} + ${read("rebarLap")} + ${read("rebarBend")} + ${read("rebarHook")}<br>
      Total Length: ${len.toFixed(2)} m<br>
      Weight: ${weight} kg<br>
      Rate: ${fmt(rate)} per kg<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Formwork Column ===
  calcFormCol: () => {
    const girth = read("formColGirth");
    const rate = read("formColPrice");
    const cost = girth * rate;

    STATE.results["Formwork Column"] = { detail: `Girth: ${girth} m`, cost };

    $("formColOut").innerHTML = `
      <strong>Formwork Column Calculation:</strong><br>
      Formula: ${girth} × ${rate}<br>
      Girth: ${girth} m<br>
      Rate: ${fmt(rate)} per m<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Formwork Upper Ground Beam ===
  calcFormUGB: () => {
    const side = read("formUGBSide");
    const soffit = read("formUGBSoffit");
    const rate = read("formUGBPrice");
    const totalArea = side + soffit;
    const cost = totalArea * rate;

    STATE.results["Formwork Upper Ground Beam"] = {
      detail: `Side + Soffit: ${totalArea.toFixed(2)} m`,
      cost
    };

    $("formUGBOut").innerHTML = `
      <strong>Formwork UGB Calculation:</strong><br>
      Formula: (${side} + ${soffit}) × ${rate}<br>
      Area: ${totalArea.toFixed(2)} m²<br>
      Rate: ${fmt(rate)} per m²<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Formwork Ground Beam ===
  calcFormGB: () => {
    const side = read("formGBSide");
    const rate = read("formGBPrice");
    const cost = side * rate;

    STATE.results["Formwork Ground Beam"] = { detail: `Side: ${side} m`, cost };

    $("formGBOut").innerHTML = `
      <strong>Formwork Ground Beam Calculation:</strong><br>
      Formula: ${side} × ${rate}<br>
      Side: ${side} m<br>
      Rate: ${fmt(rate)} per m<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Formwork Foundation ===
  calcFormFound: () => {
    const girth = read("formFoundGirth");
    const rate = read("formFoundPrice");
    const cost = girth * rate;

    STATE.results["Formwork Foundation"] = { detail: `Girth: ${girth} m`, cost };

    $("formFoundOut").innerHTML = `
      <strong>Formwork Foundation Calculation:</strong><br>
      Formula: ${girth} × ${rate}<br>
      Girth: ${girth} m<br>
      Rate: ${fmt(rate)} per m<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === General Formwork ===
  calcForm: () => {
    const length = read("formLength");
    const width = read("formWidth");
    const rate = read("formPrice");
    const area = length * width;
    const cost = area * rate;

    STATE.results["Formwork"] = { detail: `Area: ${area.toFixed(2)} m²`, cost };

    $("formOut").innerHTML = `
      <strong>Formwork Calculation:</strong><br>
      Formula: (${length} × ${width}) × ${rate}<br>
      Area: ${area.toFixed(2)} m²<br>
      Rate: ${fmt(rate)} per m²<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Ceiling ===
  calcCeil: () => {
    const length = read("ceilLength");
    const width = read("ceilWidth");
    const area = length * width;
    const typeSelect = $("ceilType");
    const rate = parseFloat(typeSelect.selectedOptions[0].dataset.price);
    const material = typeSelect.value;
    const cost = area * rate;

    STATE.results["Ceiling"] = { detail: `Area: ${area.toFixed(2)} m² (${material})`, cost };

    $("ceilOut").innerHTML = `
      <strong>Ceiling Calculation:</strong><br>
      Formula: ${length} × ${width}<br>
      Area: ${area.toFixed(2)} m²<br>
      Material: ${material}<br>
      Rate: ${fmt(rate)} per m²<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Floor Finishes ===
  calcFloor: () => {
    const length = read("floorLength");
    const width = read("floorWidth");
    const area = length * width;
    const typeSelect = $("floorType");
    const rate = parseFloat(typeSelect.selectedOptions[0].dataset.price);
    const material = typeSelect.value;
    const cost = area * rate;

    STATE.results["Floor"] = { detail: `Area: ${area.toFixed(2)} m² (${material})`, cost };

    $("floorOut").innerHTML = `
      <strong>Floor Finishes Calculation:</strong><br>
      Formula: ${length} × ${width}<br>
      Area: ${area.toFixed(2)} m²<br>
      Material: ${material}<br>
      Rate: ${fmt(rate)} per m²<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Wall External ===
  calcWallExt: () => {
    const length = read("wallExtLength");
    const height = read("wallExtWidth");
    const area = length * height;
    const typeSelect = $("wallExtType");
    const rate = parseFloat(typeSelect.selectedOptions[0].dataset.price);
    const material = typeSelect.value;
    const extras = read("wallExtDPM") + read("wallExtCoating") + read("wallExtPrice");
    const cost = area * rate + extras;

    STATE.results["Wall External"] = { detail: `Area: ${area.toFixed(2)} m² (${material})`, cost };

    $("wallExtOut").innerHTML = `
      <strong>Wall External Calculation:</strong><br>
      Formula: (${length} × ${height}) × ${rate} + extras<br>
      Area: ${area.toFixed(2)} m²<br>
      Material: ${material}<br>
      Rate: ${fmt(rate)} per m²<br>
      Extras: ${fmt(extras)}<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  },

  // === Wall Internal ===
  calcWallInt: () => {
    const length = read("wallIntLength");
    const height = read("wallIntWidth");
    const area = length * height;
    const typeSelect = $("wallIntType");
    const rate = parseFloat(typeSelect.selectedOptions[0].dataset.price);
    const material = typeSelect.value;
    const extras = read("wallIntCoating") + read("wallIntDPM") + read("wallIntPrice");
    const cost = area * rate + extras;

    STATE.results["Wall Internal"] = { detail: `Area: ${area.toFixed(2)} m² (${material})`, cost };

    $("wallIntOut").innerHTML = `
      <strong>Wall Internal Calculation:</strong><br>
      Formula: (${length} × ${height}) × ${rate} + extras<br>
      Area: ${area.toFixed(2)} m²<br>
      Material: ${material}<br>
      Rate: ${fmt(rate)} per m²<br>
      Extras: ${fmt(extras)}<br>
      <strong>Total Cost: ${fmt(cost)}</strong>
    `;
    updateReport();
  }
};

/* ===== Event Listeners ===== */
      Object.keys(calcs).forEach(id => {
        $(id)?.addEventListener("click", () => {
          try { calcs[id](); }
          catch (e) { alert("Error: " + e.message); }
        });
      });

      document.querySelectorAll(".toolbar .btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const sectionId = "section" + btn.id.replace("btn", "");
          showSection(sectionId);
        });
      });

      /* ===== Project Controls ===== */
      window.loadProject = function(name) {
        const proj = projects[name];
        if (!proj) return;
        STATE.activeProject = name;

        $("report").innerHTML = `
          <div class="report-summary">
            <h3>Project: ${name}</h3>
            <p><strong>Total:</strong> ${fmt(proj.results.total || 0)}</p>
            <p><strong>Profit (30%):</strong> ${fmt(proj.results.profit || 0)}</p>
            <p><strong>Grand Total:</strong> ${fmt(proj.results.grandTotal || 0)}</p>
          </div>`;
      };

      window.editProject = function(oldName) {
        const newName = prompt("Enter new project name:", oldName);
        if (!newName || newName === oldName) return;
        projects[newName] = projects[oldName];
        delete projects[oldName];
        projects[newName].updated = new Date().toLocaleString();
        saveProjects();
        renderProjects();
      };

      window.deleteProject = function(name) {
        if (confirm(`Are you sure you want to delete "${name}"?`)) {
          delete projects[name];
          saveProjects();
          renderProjects();
          $("report").innerHTML = "";
          if (STATE.activeProject === name) STATE.activeProject = null;
        }
      };

      /* ===== Initialize ===== */
      renderProjects();
    });
  </script>
</body>
</html>